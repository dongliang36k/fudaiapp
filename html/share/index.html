<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0" />
    <title>title</title>
    <script type="text/javascript" src="../../script/rem.js"></script>
    <link rel="stylesheet" type="text/css" href="../../css/api.css" />
    <style>
        header {
            display: block;
            text-align: center;
            background-color: #fff;
            color: #333;
            font-size: 1rem;
            height: 2.78rem;
              position: relative;
            line-height: 2.78rem;
        }

        body {
            background-color: #fff;
        }

        .head i {
            display: inline-block;
            position: absolute;
            font-size: .96rem;
            left: .8rem;
        }

        .tit {
            font-size: 1.07rem;
            color: #333;
            text-align: center;
            line-height: 1.6rem;
        }

        .h {
            font-size: .8rem;
            line-height: 1.87rem;
            color: #dd4848;
        }

        .cont {
            font-size: .69rem;
            line-height: 1.33rem;
            color: 333;
        }

        ul {
            padding: 1.07rem .85rem;
        }

        .btn {
            width: 18.29rem;
            height: 2.4rem;
            line-height: 2.4rem;
            color: #fff;
            text-align: center;
            margin: 0 auto;
            position: fixed;
            bottom: 1.87rem;
            left: .85rem;
            background: #DD4848;
            box-shadow: 0 .16rem .27rem 0 rgba(211, 56, 56, 0.59);
            border-radius: .21rem;
        }
    </style>
</head>

<body>
    <header class="head">
        <i id="back" class="iconfont icon-back" onclick="goBack()"></i> 邀请好友
    </header>
    <ul>
        <li>
            <div class="h">
                1.十倍机会
            </div>
            <div class="cont">
                每日分享APP给朋友圈或者朋友都可获得当日抢红包次数增至100次(初始10次)
            </div>
        </li>
        <li>
            <div class="h">
                2.奖励红包
            </div>
            <div class="cont">
                每日分享APP给朋友圈或者朋友都可获得多个奖励红包，不限次数，多分享多得
            </div>
        </li>
        <li>
            <div class="h">
                3.长期收益
            </div>
            <div class="cont">
                分享给好友，好友注册长期使用福袋来袭，每抢到一个红包都会随机获得奖励，邀请越多，每天坐家里即可免费获得大额收益
            </div>
        </li>
        <li>
            <div class="h">
                4.城主收益
            </div>
            <div class="cont">
                如果您是当前城主，城市用户越多，广告红包越多，即可为您增加越多的城主收益
            </div>
        </li>
    </ul>
    <div class="btn" onclick="Share()">邀请好友</div>
</body>
<script type="text/javascript" src="../../script/api.js"></script>
<script type="text/javascript" src="../../script/md5.js"></script>
<script type="text/javascript" src="../../script/request.js"></script>
<script type="text/javascript">
    apiready = function() {
        $api.fixStatusBar($api.dom('header'));
    };

    function goBack() {
        api.historyBack({}, function(ret, err) {
            if (!ret.status) {
                api.closeWin();
            }
        });
    }

    function Share() {
        var dialogBox = api.require('dialogBox');
        var wx = api.require('wx');
        dialogBox.actionMenu({
            rect: {
                h: 180
            },
            texts: {
                cancel: '取消'
            },
            items: [{
                text: '微信好友',
                icon: 'widget://img/sharewei.png'
            }, {
                text: '朋友圈',
                icon: 'widget://img/pengyou.png'
            }, {
                text: '二维码',
                icon: 'widget://img/qrcode.png'
            }],
            styles: {
                bg: '#FFF',
                column: 3,
                itemText: {
                    color: '#000',
                    size: 14,
                    marginT: 8
                },
                itemIcon: {
                    size: 40
                },
                cancel: {
                    bg: 'fs://icon.png',
                    color: '#666',
                    h: 64,
                    size: 16
                }
            }
        }, function(res) {
            dialogBox.close({
                dialogName: 'actionMenu'
            });
            if (res.eventType == 'click') {
                wx.isInstalled(function(ret, err) {
                    if (ret.installed) {
                        if (res.index == 0 || res.index == 1) {
                            wx.shareWebpage({
                                apiKey: 'wxed02780e15c94996',
                                scene: res.index == 1 ? 'timeline' : 'session',
                                title: '听说这里红包无限抢！',
                                description: '福袋来袭每天抢红包，再也不愁没有零花钱',
                                thumb: 'widget://img/hb@3x.png',
                                contentUrl: `https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx65ab7fe8fa2a81dd&redirect_uri=https%3a%2f%2fwww.hnchimay.com%2fhcSendRedPacket%2fdown.html&response_type=code&scope=snsapi_userinfo&state=${$api.getStorage('userInfo').id}#wechat_redirect`,
                            }, function(ret, err) {
                                if (ret.status) {
                                    api.toast({
                                        msg: '分享成功',
                                        duration: 2000,
                                        location: 'bottom'
                                    });
                                    sharePack();

                                } else {
                                    api.toast({
                                        msg: '分享失败',
                                        duration: 2000,
                                        location: 'bottom'
                                    });
                                }
                            });
                        } else if (res.index == 2) {
                            api.showProgress({
                                style: 'default',
                                animationType: 'fade',
                                title: '生成中...',
                                text: '先喝杯茶...',
                                modal: false
                            });

                            fnPost(
                                'https://www.hnchimay.com/hcUser/getqrcode', {
                                    values: {
                                        uid: $api.getStorage('userInfo').id,
                                    },
                                },
                                false,
                                function(ret, err) {
                                    if (ret) {
                                        var makeSharePic = api.require('makeSharePic');
                                        if (ret.success) {
                                            makeSharePic.composePic({
                                                bgPicUrl: 'https://cdn.weipaitang.com/static/20181019c42584b3-ca05-4c4a-a7bf-301bf742e6aa-W1125H2001',
                                                attachPicUrl: 'https://mp.weixin.qq.com/cgi-bin/showqrcode?ticket=' + ret.body.ticket,
                                                fileName: 'compose.png',
                                                mainWidth: 750,
                                                mainHeight: 1334,
                                                subWidth: 300,
                                                l: 224,
                                                t: 370,
                                            }, function(ret, err) {
                                                if (ret.status) {
                                                    var wx = api.require('wx');
                                                    api.hideProgress();
                                                    wx.shareImage({
                                                        apiKey: 'wxed02780e15c94996',
                                                        scene: 'session',
                                                        contentUrl: ret.filePath,
                                                    }, function(ret, err) {
                                                        if (ret.status) {
                                                            api.toast({
                                                                msg: '分享成功',
                                                                duration: 2000,
                                                                location: 'bottom'
                                                            });
                                                            sharePack();

                                                        } else {
                                                            api.toast({
                                                                msg: '分享失败',
                                                                duration: 2000,
                                                                location: 'bottom'
                                                            });
                                                        }
                                                    });
                                                } else {
                                                    api.toast({
                                                        msg: err.message,
                                                        duration: 2000,
                                                        location: 'bottom'
                                                    });
                                                }
                                            });
                                        }
                                    } else {
                                        api.toast({
                                            msg: JSON.stringify(err),
                                            duration: 2000,
                                            location: 'bottom'
                                        });
                                    }
                                }
                            );
                        }
                    } else {
                        api.toast({
                            msg: '检测到您未安装微信，请先安装',
                            duration: 2000,
                            location: 'bottom'
                        });

                    }
                });
            }
        });
    }
    function sharePack(){
       fnPost(
         'https://www.hnchimay.com/hcSendRedPacket/sharepackage',
         {
           values:{},
         },
         false,
         function(ret,err){
           console.log(JSON.stringify(ret));
         }
       )
    }
</script>

</html>
